\RequirePackage{lipsum,zhlipsum}
\RequirePackage{pifont,fontawesome}
\RequirePackage{multicol,etoolbox}
\RequirePackage[abspath]{currfile}

\edef\cfDir{\currfiledir}
\newcommand{\updatePath}{\edef\cfDir{\currfiledir}}
\newcommand{\rpath}[1]{\cfDir #1}
\newcommand{\rinput}[1]{%
\updatePath
\input{\rpath{#1}}
}
\newcommand{\rinclude}[1]{%
\updatePath
\include{\rpath{#1}}
}
\newcommand{\rbibliography}[1]{%
\updatePath
\bibliography{\rpath{#1}}
}

\RequirePackage{eso-pic,tikz}
\usetikzlibrary{positioning}
\RequirePackage{wrapfig}
\RequirePackage{mathptmx,amsmath,float,floatflt,filecontents}
\RequirePackage[toc,title,titletoc]{appendix}
\RequirePackage{multirow,longtable,tabularx,diagbox}
\RequirePackage{ifxetex,ifluatex,hologo}
\RequirePackage{setspace,listings}
\RequirePackage[
    a4paper,
	top=1cm,
	bottom=1cm,
	left=2cm,
	right=2cm,
    %   twoside,
    %   bindingoffset=1cm,
    %   asymmetric,
	headheight=0.5cm,
	headsep=0.5cm,
	footskip=1.0cm,
	includehead=true,
	includefoot=true]{geometry}
\RequirePackage{xstring}

\RequirePackage{fancyhdr,lastpage}

\fancypagestyle{fancyplain}{}
%
\fancypagestyle{textpage}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
  \fancyhead[LE]{%
    \begin{tikzpicture}[remember picture, overlay, shift={(current page.north west)}]
      \node[above] at (1cm,-1.5cm) {\mdseries\sffamily\large\thepage};
      % \node[rectangle,%
      %   above right,
      %   draw = \@backgroundcolor,
      %   text = \@sectioncolor,
      %   fill = \@backgroundcolor,
      %   minimum width = 2cm, 
      %   minimum height = 1cm,
      %   rotate=-90] (r) at (0cm,-0.2\paperheight) {%
      %   \bf\sffamily\large \thesubsection};
    \end{tikzpicture}
    {\sffamily\@firstauthor \hspace{1pt} \textit{et al.}}%
    %
    % \begin{tikzpicture}[remember picture, overlay, shift={(current page.south west)}]
    %   \node[above left=0.01\paperheight and 0.10\paperwidth] at (current page.south east) {%
    %     {\normalsize\color{black}{Copyright \hspace{1pt} \copyright \hspace{1pt} \the\year \hspace{1pt} \@firstauthor \hspace{1pt}  et al. . All Rights Reserved.}}};
    % \end{tikzpicture}
  }
  \fancyhead[RO]{%
    {\sffamily \@institution}%
    \begin{tikzpicture}[remember picture, overlay, shift={(current page.north east)}]
      \node[above] at (-1cm,-1.5cm) {\mdseries\sffamily\large\thepage};
      % \node[rectangle,%
      %   below right,
      %   draw = \@backgroundcolor,
      %   text = \@sectioncolor,
      %   fill = \@backgroundcolor,
      %   minimum width = 2cm, 
      %   minimum height = 1cm,
      %   rotate=-90] (r) at (0cm,-0.2\paperheight) {%
      %   \bf\sffamily\large \thesubsection};
    \end{tikzpicture}
    %
    % \begin{tikzpicture}[remember picture, overlay, shift={(current page.south west)}]
    %   \node[above right=0.01\paperheight and 0.10\paperwidth] at (current page.south west) {%
    %     {\normalsize\color{black}{Copyright \hspace{1pt} \copyright \hspace{1pt} \the\year \hspace{1pt} \@firstauthor \hspace{1pt}  et al. . All Rights Reserved.}}};
    % \end{tikzpicture}
  }
}

\pagestyle{textpage}

\RequirePackage[explicit]{titlesec}
\RequirePackage{titletoc,tocloft}
\RequirePackage{ifthen}


\titleformat{name=\subsection}
{%format
  \mdseries\sffamily\large\color{\@sectioncolor}% 
}
{%label
  \thesubsection
}
{%sep
1em
}
{%before-code
#1
}
[%after-code
]

\titleformat{name=\section}
{%format
  \bfseries\sffamily\Large\color{\@sectioncolor}% 
}
{%label
  \thesection
}
{%sep
1em
}
{%before-code
#1
}
[%after-code
]



\newcommand{\existchinese}[1]{%
\ifbool{#1}{%
  \renewcommand{\contentsname}{\bfseries\sffamily {目 \quad 录}}

  \ctexset{%
    punct=quanjiao,
    space=auto,
    autoindent=true,
    bibname = {文\quad 献},
    appendixname = {Appendix},
    %
    % part={%
    %   name={第,部分},
    %   number=\thepart,
    % },
    % chapter={%
    %   name={第,章},
    %   number=\thechapter,
    % },
    section={%
      name={},
      number=\thesection,
    },
    appendix={%
      name={附录\space},
      % name={\appendixname\space},
      % number=\Alph{\section},
    }
  }
  \xeCJKsetup{%
    CJKmath=true,
    AutoFallBack=true,
    AutoFakeBold=true,
    AutoFakeSlant=true
  }
  
  % Set Chinese Fonts
  \setCJKmainfont{FZShuSong-Z01S}
  \setCJKsansfont{FZYouHJ VF WT W H 1}
  \setCJKmonofont{FZFangSong-Z02S}
  
  % \RequirePackage[default]{sourceserifpro}
  % \RequirePackage{sourcesanspro}
  % \RequirePackage{sourcecodepro}

  % \setCJKmainfont{Source Han Serif CN}
  % \setCJKsansfont{Source Han Sans SC}
  % \setCJKmonofont{Source Han Sans SC}
  % \setCJKfamilyfont{boldsong}{Source Han Serif CN Heavy}
  }{%
    \renewcommand{\cftchappresnum}{Chapter\ } 
    \renewcommand{\cftchapnumwidth}{6.5em}
  }
}

\RequirePackage{flushend,cite,url,xcolor}
\RequirePackage{hyperref,bookmark}
\hypersetup{%
  % pdftitle={pdf-title},
  % pdfsubject={pdf-description},
  bookmarksnumbered=true,
  bookmarksopen=true,
  bookmarksopenlevel=2,
  pdfstartview=Fit,
  pdfpagemode=UseOutlines,
  pdfpagelayout=OneColumn,
  %
  breaklinks=true,
  colorlinks,
  linkbordercolor=white,
  pdfborder={0 0 0},
  citebordercolor=white,
  bookmarksopen=false,
  linkcolor={green!80!black},
  citecolor={red!70!black},
  urlcolor={blue!70!black}
}
\ifxetex % xelatex
\else % pdflatex
  \RequirePackage{breakurl}
  \RequirePackage[kerning,spacing]{microtype}
\fi

\definecolor{main-color}{HTML}{734200}
\definecolor{title-color}{HTML}{734200}
\definecolor{sec-color}{HTML}{9b7337}
\definecolor{label-color}{HTML}{979797}
\definecolor{bg-color}{HTML}{f4eadf}

\newcommand{\@firstauthor}{First Author}
\newcommand{\firstauthor}[1]{\renewcommand{\@firstauthor}{#1}}

\newcommand{\@institution}{Institution}
\newcommand{\institution}[1]{\renewcommand{\@institution}{#1}}

\newcommand{\@titlecolor}{title-color}
\newcommand{\titlecolor}[1]{\renewcommand{\@titlecolor}{#1}}

\newcommand{\@sectioncolor}{sec-color}
\newcommand{\sectioncolor}[1]{\renewcommand{\@sectioncolor}{#1}}

\newcommand{\@backgroundcolor}{bg-color}
\newcommand{\backgroundcolor}[1]{\renewcommand{\@backgroundcolor}{#1}}

\RequirePackage{abstract}
\renewcommand{\abstractnamefont}{%
  \bfseries\sffamily\Large\color{\@sectioncolor}
}
\renewcommand{\contentsname}{Contents}
\renewcommand{\cfttoctitlefont}{%
  \bfseries\rmfamily\color{\@sectioncolor}\Large
}
\renewcommand{\cftaftertoctitle}{\thispagestyle{textpage}}
\renewcommand{\refname}{References}
\newcommand{\hrefcolor}[1]{\hypersetup{linkcolor=#1}\color{#1}}
\renewcommand{\cftsecfont}{\hrefcolor{\@sectioncolor}\normalsize\mdseries\sffamily}
\renewcommand{\cftsubsecfont}{\hrefcolor{black}\normalsize\sffamily}
% \renewcommand{\cftsubsecfont}{\hrefcolor{\@sectioncolor}\normalsize\sffamily}

\def\maketitle{%
	\par

	\begingroup

	\renewcommand\thefootnote{\fnsymbol{footnote}}%
	\def\@makefnmark{\hbox to\z@{$\m@th^{\@thefnmark}$\hss}}%
	\long\def\@makefntext##1{\parindent 1em\noindent
	\hbox to1.8em{\hss$\m@th^{\@thefnmark}$}##1}%

	\if@twocolumn
		\twocolumn[\@maketitle]%
	\else
		\newpage
		\global\@topnum\z@
		\@maketitle
	\fi

	\@thanks

	\endgroup

	\setcounter{footnote}{0}%
	\let\maketitle\relax
	\let\@maketitle\relax
	\gdef\@thanks{}
	\gdef\@author{}
	\gdef\@title{}
	\let\thanks\relax
}
\def\@maketitle{%
	\newpage
	\vbox to 2.5in{%
		\vspace*{\fill}
		\vskip 2em
		\begin{center}%
            {\huge\bfseries\rmfamily\color{\@titlecolor} \@title \par}%
            % {\Large\bf \@title \par}%
			\vskip 0.375in minus 0.300in
			{%
				\large\it%
				\lineskip .5em
                \begin{tabular}[t]{c}
					\@author
				\end{tabular}
				\par
			}%
		\end{center}%
		\par
	\vspace*{\fill}
	\vskip 1.5em
	}
}

\ifxetex
% Main section titles are flushlefted.
\def\CTEX@section@format{\Large\bfseries}
\else
% The abstract is preceded by a 12-pt bold centered heading
\def\abstract{%
	\begin{center}%
		{\large\bf \abstractname\vspace{-.5em}\vspace{\z@}}%
	\end{center}}
\def\endabstract{}
% Main section titles are 12-pt bold.  Others can be same or smaller.
\def\section{\@startsection {section}{1}{\z@}{-3.5ex plus-1ex minus
    -.2ex}{2.3ex plus.2ex}{\reset@font\large\bf}}
\fi

% hopefully embeds all fonts in pdf
\ifxetex % xelatex
  \RequirePackage{xltxtra,fontspec,xunicode}
  
  % Set English Fonts
  \setmainfont{ITC Berkeley Oldstyle Pro}
  % \setmainfont{Times New Roman}
  \setsansfont{Helvetica}  % Windows 下可使用类似的 Arial 字体
  \setmonofont{LettrGoth12 BT}
  % \setmonofont{Courier New}

\else % pdflatex
  \RequirePackage[T1]{fontenc}
  \RequirePackage[utf8]{inputenc}
  % Set Font Type
  \RequirePackage{pslatex}

  % \RequirePackage[default]{sourceserifpro}
  % \RequirePackage{sourcesanspro}
  % \RequirePackage{sourcecodepro}
\fi
